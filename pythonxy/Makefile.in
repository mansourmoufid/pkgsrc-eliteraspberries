# $NetBSD$

DISTNAME=	Python-{{X}}.{{Y}}.{{Z}}
PKGNAME=	python{{X}}{{Y}}-{{Z}}
PKGREVISION=	2
CATEGORIES=	lang
MASTER_SITES=	https://www.python.org/ftp/python/{{X}}.{{Y}}.{{Z}}/
EXTRACT_SUFX=	.tgz

MAINTAINER=	mansourmoufid@gmail.com
HOMEPAGE=	https://www.python.org/
COMMENT=	Python programming language
LICENSE=	python-software-foundation

GNU_CONFIGURE=	yes
USE_TOOLS+=	autoconf autoconf-archive automake autoreconf gmake perl pkg-config
USE_LANGUAGES=	c

PKGCONFIG_OVERRIDE+=	Misc/python.pc.in

pre-configure:
	cd ${WRKSRC} && autoreconf -i

CONFIGURE_ARGS+=	--disable-universalsdk
CONFIGURE_ARGS+=	--enable-shared
CONFIGURE_ARGS+=	--mandir=${PKGMANDIR}
CONFIGURE_ARGS+=	--without-ensurepip
CONFIGURE_ARGS+=	--without-pydebug
CONFIGURE_ARGS+=	--without-pymalloc

CONFIGURE_ARGS+=	have_openssl=yes
CONFIGURE_ARGS+=	OPENSSL_INCLUDES="-I${BUILDLINK_DIR}/include"
CONFIGURE_ARGS+=	OPENSSL_LDFLAGS="-L${BUILDLINK_DIR}/lib"
CONFIGURE_ARGS+=	OPENSSL_LIBS="-lssl -lcrypto"

CONFIGURE_ARGS+=	LIBFFI_INCLUDEDIR=${BUILDLINK_DIR}/include
CONFIGURE_ARGS+=	OPT=""

.include "../../eliteraspberries/tcl/Makefile.version"
TCLTK_LIBS=		-ltcl${TCL_BASEVER} -ltk${TCL_BASEVER}
CONFIGURE_ARGS+=	--with-tcltk-includes="-I${BUILDLINK_DIR}/include"
CONFIGURE_ARGS+=	--with-tcltk-libs="-L${BUILDLINK_DIR}/lib ${TCLTK_LIBS}"

CONFIGURE_ENV+=		_PYTHON_HOST_PLATFORM=${LOWER_OPSYS}
MAKE_ENV+=		_PYTHON_HOST_PLATFORM=${LOWER_OPSYS}

PLIST_SUBST+=	X={{X}}
PLIST_SUBST+=	Y={{Y}}
PLIST_SUBST+=	Z={{Z}}

post-install: fix-suffixes

.PHONY: fix-suffixes
fix-suffixes: fix-suffixes.sh
	sh fix-suffixes.sh

.include "../../archivers/bzip2/buildlink3.mk"
.include "../../archivers/xz/buildlink3.mk"
.include "../../databases/sqlite3/buildlink3.mk"
.include "../../devel/zlib/buildlink3.mk"
.include "../../devel/libffi/buildlink3.mk"
.include "../../devel/ncurses/buildlink3.mk"
.include "../../devel/readline/buildlink3.mk"
.include "../../eliteraspberries/tcl/buildlink3.mk"
.include "../../eliteraspberries/tk/buildlink3.mk"
.include "../../security/openssl/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
